name: Update Shanxi TV Source File

on:
  schedule:
    # åŒ—äº¬æ—¶é—´ 09:00 = UTC 01:00
    - cron: '10 1 * * *'
    # åŒ—äº¬æ—¶é—´ 17:00 = UTC 09:00  
    - cron: '10 9 * * *'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  update-file:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Setup Git
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "41898282+github-actions[bot]@users.noreply.github.com"
        
    - name: Prepare directory
      run: |
        mkdir -p tv
        echo "åˆ›å»º tv ç›®å½•..."
        
    - name: Download TV source file
      id: download
      run: |
        echo "å¼€å§‹ä¸‹è½½ç›´æ’­æºæ–‡ä»¶..."
        
        REMOTE_URL="https://my9.ltd/tv/pllive.txt"
        LOCAL_PATH="tv/pllive.txt"
        TEMP_FILE="pllive_temp.txt"
        SHANXI_PATH="tv/shanxi.txt"
        
        echo "ç›®æ ‡URL: $REMOTE_URL"
        echo "ä¿å­˜è·¯å¾„: $LOCAL_PATH"
        echo "å±±è¥¿é¢‘é“è·¯å¾„: $SHANXI_PATH"
        
        # æ¸…ç©ºä¸´æ—¶æ–‡ä»¶
        rm -f "$TEMP_FILE" "$LOCAL_PATH" "$SHANXI_PATH"
        
        # ä¸‹è½½åŸå§‹æ–‡ä»¶
        echo ""
        echo "=== å¼€å§‹ä¸‹è½½ ==="
        
        # å°è¯•å¤šä¸ªUser-Agent
        USER_AGENTS=(
          "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36"
          "curl/8.8.0"
          "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/121.0"
        )
        
        DOWNLOAD_SUCCESS=false
        
        for UA in "${USER_AGENTS[@]}"; do
          echo ""
          echo "å°è¯• User-Agent: $(echo $UA | cut -c1-40)..."
          
          curl -s -L \
            -o "$TEMP_FILE" \
            -H "User-Agent: $UA" \
            -H "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8" \
            -H "Accept-Language: zh-CN,zh;q=0.9" \
            --max-time 60 \
            --retry 2 \
            "$REMOTE_URL"
            
          if [ -f "$TEMP_FILE" ] && [ -s "$TEMP_FILE" ]; then
            FILE_SIZE=$(wc -c < "$TEMP_FILE")
            echo "ä¸‹è½½å¤§å°: $FILE_SIZE å­—èŠ‚"
            
            if [ $FILE_SIZE -gt 10000 ]; then  # æ–‡ä»¶åº”è¯¥æ¯”è¾ƒå¤§
              echo "âœ… ä¸‹è½½æˆåŠŸ"
              mv "$TEMP_FILE" "$LOCAL_PATH"
              DOWNLOAD_SUCCESS=true
              echo "method=$(echo $UA | cut -d' ' -f1 | tr -d '()')" >> $GITHUB_OUTPUT
              break
            else
              echo "âš ï¸ æ–‡ä»¶å¤ªå°ï¼Œé‡è¯•..."
              rm -f "$TEMP_FILE"
            fi
          fi
          sleep 2
        done
        
        if [ "$DOWNLOAD_SUCCESS" = false ]; then
          echo "âŒ æ‰€æœ‰ä¸‹è½½æ–¹æ³•éƒ½å¤±è´¥"
          # åˆ›å»ºå ä½æ–‡ä»¶
          echo "# ç›´æ’­æºæ–‡ä»¶ä¸‹è½½å¤±è´¥ - $(date)" > "$LOCAL_PATH"
          echo "# è¯·æ£€æŸ¥URL: $REMOTE_URL" >> "$LOCAL_PATH"
          echo "method=failed" >> $GITHUB_OUTPUT
        fi
        
        echo "downloaded=true" >> $GITHUB_OUTPUT
        
    - name: Extract Shanxi channels
      id: extract-shanxi
      if: steps.download.outputs.downloaded == 'true'
      run: |
        echo "å¼€å§‹ç­›é€‰å±±è¥¿çœé¢‘é“..."
        
        SOURCE_FILE="tv/pllive.txt"
        SHANXI_FILE="tv/shanxi.txt"
        
        if [ ! -f "$SOURCE_FILE" ] || [ ! -s "$SOURCE_FILE" ]; then
          echo "âŒ æºæ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸ºç©º"
          echo "shanxi_channels=0" >> $GITHUB_OUTPUT
          exit 0
        fi
        
        # æ¸…ç©ºå±±è¥¿é¢‘é“æ–‡ä»¶
        > "$SHANXI_FILE"
        
        # æ·»åŠ æ–‡ä»¶å¤´éƒ¨ä¿¡æ¯
        echo "# Shanxi TV Channels" >> "$SHANXI_FILE"
        echo "# Extracted from: pllive.txt" >> "$SHANXI_FILE"
        echo "# Date: $(date '+%Y-%m-%d %H:%M:%S')" >> "$SHANXI_FILE"
        echo "#" >> "$SHANXI_FILE"
        
        # å®šä¹‰ç­›é€‰å…³é”®è¯ï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
        SHANXI_KEYWORDS=(
          "å±±è¥¿"
          "å¤ªåŸ"
          "å¤§åŒ"
          "æœ”å·"
          "å¿»å·"
          "é˜³æ³‰"
          "å•æ¢"
          "æ™‹ä¸­"
          "é•¿æ²»"
          "æ™‹åŸ"
          "ä¸´æ±¾"
          "è¿åŸ"
        )
        
        # å¤®è§†ç›¸å…³å…³é”®è¯
        CCTV_KEYWORDS=(
          "CCTV"
          "å¤®è§†"
          "ä¸­å¤®"
        )
        
        # å«è§†å…³é”®è¯
        SATELLITE_KEYWORDS=(
          "å«è§†"
          "å«è§†é«˜æ¸…"
          "å«è§†æ ‡æ¸…"
        )
        
        # ç»„æ’­å…³é”®è¯
        MULTICAST_KEYWORDS=(
          "rtp://"
          "udp://"
          "@239"
          "å±±è¥¿è”é€š"
          "å±±è¥¿ç”µä¿¡"
          "å±±è¥¿ç§»åŠ¨"
          "unicom"
          "telecom"
          "ç§»åŠ¨"
          "è”é€š"
          "ç”µä¿¡"
        )
        
        # è®¡æ•°å™¨
        CCTV_COUNT=0
        SATELLITE_COUNT=0
        SHANXI_LOCAL_COUNT=0
        MULTICAST_COUNT=0
        OTHER_COUNT=0
        
        # å¤„ç†æ–‡ä»¶ï¼ŒæŒ‰è¡Œè¯»å–
        while IFS= read -r line; do
          # è·³è¿‡ç©ºè¡Œå’Œæ³¨é‡Š
          if [[ -z "$line" ]] || [[ "$line" == \#* ]]; then
            echo "$line" >> "$SHANXI_FILE"
            continue
          fi
            
          # ç»Ÿä¸€è½¬æ¢ä¸ºå¤§å†™è¿›è¡Œæ¯”è¾ƒï¼ˆä¸åŒºåˆ†å¤§å°å†™ï¼‰
          line_upper=$(echo "$line" | tr '[:lower:]' '[:upper:]')
          
          # æ£€æŸ¥æ˜¯å¦ä¸ºå±±è¥¿ç›¸å…³é¢‘é“
          is_shanxi=false
          for keyword in "${SHANXI_KEYWORDS[@]}"; do
            keyword_upper=$(echo "$keyword" | tr '[:lower:]' '[:upper:]')
            if [[ "$line_upper" == *"$keyword_upper"* ]]; then
              is_shanxi=true
              break
            fi
          done
          
          # å¦‚æœæ˜¯å±±è¥¿ç›¸å…³ï¼Œå†åˆ†ç±»
          if [ "$is_shanxi" = true ]; then
            # æ£€æŸ¥æ˜¯å¦ä¸ºå¤®è§†
            is_cctv=false
            for keyword in "${CCTV_KEYWORDS[@]}"; do
              keyword_upper=$(echo "$keyword" | tr '[:lower:]' '[:upper:]')
              if [[ "$line_upper" == *"$keyword_upper"* ]]; then
                is_cctv=true
                break
              fi
            done
            
            # æ£€æŸ¥æ˜¯å¦ä¸ºå«è§†
            is_satellite=false
            for keyword in "${SATELLITE_KEYWORDS[@]}"; do
              keyword_upper=$(echo "$keyword" | tr '[:lower:]' '[:upper:]')
              if [[ "$line_upper" == *"$keyword_upper"* ]]; then
                is_satellite=true
                break
              fi
            done
            
            # æ£€æŸ¥æ˜¯å¦ä¸ºç»„æ’­
            is_multicast=false
            for keyword in "${MULTICAST_KEYWORDS[@]}"; do
              keyword_upper=$(echo "$keyword" | tr '[:lower:]' '[:upper:]')
              if [[ "$line_upper" == *"$keyword_upper"* ]]; then
                is_multicast=true
                break
              fi
            done
            
            # åˆ†ç±»è®¡æ•°
            if [ "$is_cctv" = true ]; then
              CCTV_COUNT=$((CCTV_COUNT + 1))
              echo "# CCTVå±±è¥¿æº" >> "$SHANXI_FILE"
            elif [ "$is_satellite" = true ]; then
              SATELLITE_COUNT=$((SATELLITE_COUNT + 1))
              echo "# å«è§†å±±è¥¿æº" >> "$SHANXI_FILE"
            elif [ "$is_multicast" = true ]; then
              MULTICAST_COUNT=$((MULTICAST_COUNT + 1))
              echo "# å±±è¥¿ç»„æ’­" >> "$SHANXI_FILE"
            else
              SHANXI_LOCAL_COUNT=$((SHANXI_LOCAL_COUNT + 1))
              echo "# å±±è¥¿åœ°æ–¹å°" >> "$SHANXI_FILE"
            fi
            
            echo "$line" >> "$SHANXI_FILE"
            
          # å¦‚æœä¸æ˜¯å±±è¥¿ç›¸å…³ï¼Œä½†åŒ…å«ç»„æ’­åœ°å€ä¹Ÿä¿ç•™ï¼ˆå±±è¥¿è”é€š/ç”µä¿¡ç»„æ’­ï¼‰
          elif [[ "$line" == rtp://* ]] || [[ "$line" == udp://* ]] || [[ "$line_upper" == *239* ]]; then
            # æ£€æŸ¥æ˜¯å¦åŒ…å«å±±è¥¿å…³é”®è¯
            is_shanxi_multicast=false
            for keyword in "${SHANXI_KEYWORDS[@]}"; do
              keyword_upper=$(echo "$keyword" | tr '[:lower:]' '[:upper:]')
              if [[ "$line_upper" == *"$keyword_upper"* ]]; then
                is_shanxi_multicast=true
                break
              fi
            done
            
            if [ "$is_shanxi_multicast" = true ]; then
              MULTICAST_COUNT=$((MULTICAST_COUNT + 1))
              echo "# å±±è¥¿ç»„æ’­" >> "$SHANXI_FILE"
              echo "$line" >> "$SHANXI_FILE"
            fi
          fi
        done < "$SOURCE_FILE"
        
        # æ·»åŠ åˆ†ç±»ç»Ÿè®¡
        echo "" >> "$SHANXI_FILE"
        echo "# é¢‘é“ç»Ÿè®¡" >> "$SHANXI_FILE"
        echo "# å¤®è§†å±±è¥¿æº: $CCTV_COUNT" >> "$SHANXI_FILE"
        echo "# å«è§†å±±è¥¿æº: $SATELLITE_COUNT" >> "$SHANXI_FILE"
        echo "# å±±è¥¿åœ°æ–¹å°: $SHANXI_LOCAL_COUNT" >> "$SHANXI_FILE"
        echo "# å±±è¥¿ç»„æ’­æº: $MULTICAST_COUNT" >> "$SHANXI_FILE"
        echo "# æ€»è®¡: $((CCTV_COUNT + SATELLITE_COUNT + SHANXI_LOCAL_COUNT + MULTICAST_COUNT))" >> "$SHANXI_FILE"
        
        TOTAL_CHANNELS=$((CCTV_COUNT + SATELLITE_COUNT + SHANXI_LOCAL_COUNT + MULTICAST_COUNT))
        
        echo "âœ… ç­›é€‰å®Œæˆ"
        echo "æºæ–‡ä»¶å¤§å°: $(wc -l < "$SOURCE_FILE") è¡Œ"
        echo "å±±è¥¿é¢‘é“æ•°: $TOTAL_CHANNELS ä¸ª"
        echo "  - å¤®è§†å±±è¥¿æº: $CCTV_COUNT"
        echo "  - å«è§†å±±è¥¿æº: $SATELLITE_COUNT"
        echo "  - å±±è¥¿åœ°æ–¹å°: $SHANXI_LOCAL_COUNT"
        echo "  - å±±è¥¿ç»„æ’­æº: $MULTICAST_COUNT"
        
        echo "shanxi_channels=$TOTAL_CHANNELS" >> $GITHUB_OUTPUT
        echo "shanxi_cctv=$CCTV_COUNT" >> $GITHUB_OUTPUT
        echo "shanxi_satellite=$SATELLITE_COUNT" >> $GITHUB_OUTPUT
        echo "shanxi_local=$SHANXI_LOCAL_COUNT" >> $GITHUB_OUTPUT
        echo "shanxi_multicast=$MULTICAST_COUNT" >> $GITHUB_OUTPUT
        
    - name: Check if files changed
      id: check-change
      if: steps.download.outputs.downloaded == 'true'
      run: |
        echo "æ£€æŸ¥æ–‡ä»¶å˜åŒ–..."
        
        CHANGED_FILES=()
        
        # æ£€æŸ¥åŸå§‹æ–‡ä»¶
        if [ -f "tv/pllive.txt" ]; then
          if git diff --quiet "tv/pllive.txt" 2>/dev/null; then
            echo "åŸå§‹æ–‡ä»¶æ— å˜åŒ–"
          else
            echo "åŸå§‹æ–‡ä»¶æœ‰å˜åŒ–"
            CHANGED_FILES+=("tv/pllive.txt")
          fi
        fi
        
        # æ£€æŸ¥å±±è¥¿é¢‘é“æ–‡ä»¶
        if [ -f "tv/shanxi.txt" ]; then
          if git diff --quiet "tv/shanxi.txt" 2>/dev/null; then
            echo "å±±è¥¿é¢‘é“æ–‡ä»¶æ— å˜åŒ–"
          else
            echo "å±±è¥¿é¢‘é“æ–‡ä»¶æœ‰å˜åŒ–"
            CHANGED_FILES+=("tv/shanxi.txt")
          fi
        fi
        
        if [ ${#CHANGED_FILES[@]} -eq 0 ]; then
          echo "æ²¡æœ‰æ–‡ä»¶å˜åŒ–"
          echo "has_change=false" >> $GITHUB_OUTPUT
        else
          echo "æ£€æµ‹åˆ°æ–‡ä»¶å˜åŒ–: ${CHANGED_FILES[*]}"
          echo "has_change=true" >> $GITHUB_OUTPUT
        fi
        
    - name: Commit and push changes
      if: steps.check-change.outputs.has_change == 'true'
      run: |
        echo "å‡†å¤‡æäº¤æ–‡ä»¶..."
        
        # æ·»åŠ æ‰€æœ‰å˜åŒ–çš„æ–‡ä»¶
        git add tv/
        
        # è·å–ç»Ÿè®¡ä¿¡æ¯
        TOTAL_CHANNELS="${{ steps.extract-shanxi.outputs.shanxi_channels }}"
        CCTV_COUNT="${{ steps.extract-shanxi.outputs.shanxi_cctv }}"
        SATELLITE_COUNT="${{ steps.extract-shanxi.outputs.shanxi_satellite }}"
        LOCAL_COUNT="${{ steps.extract-shanxi.outputs.shanxi_local }}"
        MULTICAST_COUNT="${{ steps.extract-shanxi.outputs.shanxi_multicast }}"
        METHOD="${{ steps.download.outputs.method }}"
        
        # æäº¤ä¿¡æ¯
        COMMIT_MSG="ğŸ“º æ›´æ–°å±±è¥¿ç›´æ’­æº - $(date '+%Y-%m-%d %H:%M UTC')"
        COMMIT_MSG="$COMMIT_MSG | æ€»è®¡: ${TOTAL_CHANNELS}é¢‘é“"
        
        if [ -n "$CCTV_COUNT" ] && [ "$CCTV_COUNT" != "" ]; then
          COMMIT_MSG="$COMMIT_MSG (å¤®è§†${CCTV_COUNT}/å«è§†${SATELLITE_COUNT}/åœ°æ–¹${LOCAL_COUNT}/ç»„æ’­${MULTICAST_COUNT})"
        fi
        
        COMMIT_MSG="$COMMIT_MSG | æ–¹æ³•: ${METHOD}"
        
        git commit -m "$COMMIT_MSG"
        
        echo "æ¨é€åˆ°GitHub..."
        git push
        
        echo "âœ… æäº¤å¹¶æ¨é€å®Œæˆ"
        
    - name: Show detailed final status
      run: |
        echo "=========================================="
        echo "          å±±è¥¿é¢‘é“ç­›é€‰æŠ¥å‘Š"
        echo "=========================================="
        
        echo "æ‰§è¡Œå®Œæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S UTC')"
        echo "å¯¹åº”åŒ—äº¬æ—¶é—´: $(date -d '+8 hours' '+%Y-%m-%d %H:%M:%S')"
        
        echo ""
        echo "ğŸ“ æ–‡ä»¶åˆ—è¡¨:"
        ls -lh tv/*.txt 2>/dev/null || echo "æ²¡æœ‰tvç›®å½•"
        
        echo ""
        if [ -f "tv/pllive.txt" ]; then
          echo "ğŸ“¦ åŸå§‹æ–‡ä»¶ä¿¡æ¯:"
          ORIG_SIZE=$(wc -c < "tv/pllive.txt")
          ORIG_LINES=$(wc -l < "tv/pllive.txt" 2>/dev/null || echo "0")
          echo "å¤§å°: $ORIG_SIZE å­—èŠ‚, è¡Œæ•°: $ORIG_LINES"
        fi
        
        echo ""
        if [ -f "tv/shanxi.txt" ]; then
          echo "ğŸ”ï¸ å±±è¥¿é¢‘é“æ–‡ä»¶ä¿¡æ¯:"
          SHANXI_SIZE=$(wc -c < "tv/shanxi.txt")
          SHANXI_LINES=$(wc -l < "tv/shanxi.txt" 2>/dev/null || echo "0")
          echo "å¤§å°: $SHANXI_SIZE å­—èŠ‚, è¡Œæ•°: $SHANXI_LINES"
          
          echo ""
          echo "ğŸ“Š é¢‘é“åˆ†ç±»é¢„è§ˆ:"
          echo "----------------------------------------"
          
          # æ˜¾ç¤ºå„åˆ†ç±»ç¤ºä¾‹
          for category in "CCTVå±±è¥¿æº" "å«è§†å±±è¥¿æº" "å±±è¥¿åœ°æ–¹å°" "å±±è¥¿ç»„æ’­"; do
            echo "ã€$categoryã€‘:"
            grep -A1 "# $category" "tv/shanxi.txt" | head -4 | grep -v "^# " | head -2
            echo ""
          done
          
          echo "----------------------------------------"
          
          # æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
          echo ""
          echo "ğŸ”¢ è¯¦ç»†ç»Ÿè®¡:"
          grep "^# é¢‘é“ç»Ÿè®¡" -A5 "tv/shanxi.txt" | tail -5
        else
          echo "âŒ å±±è¥¿é¢‘é“æ–‡ä»¶æœªç”Ÿæˆ"
        fi
        
        echo ""
        echo "ğŸ” å…³é”®è¯ç­›é€‰è¯´æ˜:"
        echo "1. å±±è¥¿åœ°åŒº: å±±è¥¿ã€å¤ªåŸã€å¤§åŒã€æœ”å·ã€å¿»å·ã€é˜³æ³‰ã€å•æ¢ã€æ™‹ä¸­ã€é•¿æ²»ã€æ™‹åŸã€ä¸´æ±¾ã€è¿åŸ"
        echo "2. å¤®è§†: CCTVã€å¤®è§†ã€ä¸­å¤®"
        echo "3. å«è§†: å«è§†ã€å«è§†é«˜æ¸…ã€å«è§†æ ‡æ¸…"
        echo "4. ç»„æ’­: rtp://ã€udp://ã€@239ã€å±±è¥¿è”é€šã€å±±è¥¿ç”µä¿¡ã€å±±è¥¿ç§»åŠ¨"
        
        echo ""
        echo "â° ä¸‹æ¬¡è‡ªåŠ¨æ‰§è¡Œ: UTC 01:10 å’Œ 09:10 (åŒ—äº¬æ—¶é—´ 09:10 å’Œ 17:10)"        
        # ç»Ÿè®¡å„ç±»é¢‘é“æ•°é‡
        UNICOM_COUNT=$(grep -c -i "è”é€š" "$FILE_PATH" 2>/dev/null || echo 0)
        TELECOM_COUNT=$(grep -c -i "ç”µä¿¡" "$FILE_PATH" 2>/dev/null || echo 0)
        MOBILE_COUNT=$(grep -c -i "ç§»åŠ¨" "$FILE_PATH" 2>/dev/null || echo 0)
        MULTICAST_COUNT=$(grep -c -E "rtp://|udp://" "$FILE_PATH" 2>/dev/null || echo 0)
        SHANXI_COUNT=$(grep -c -i "å±±è¥¿" "$FILE_PATH" 2>/dev/null || echo 0)
        
        echo "=== æäº¤ä¿¡æ¯ ==="
        echo "æ–‡ä»¶å¤§å°: $FILE_SIZE å­—èŠ‚"
        echo "æ–‡ä»¶è¡Œæ•°: $FILE_LINES è¡Œ"
        echo "å±±è¥¿è”é€š: $UNICOM_COUNT ä¸ª"
        echo "å±±è¥¿ç”µä¿¡: $TELECOM_COUNT ä¸ª"
        echo "å±±è¥¿ç§»åŠ¨: $MOBILE_COUNT ä¸ª"
        echo "ç»„æ’­åœ°å€: $MULTICAST_COUNT ä¸ª"
        echo "å±±è¥¿ç›¸å…³: $SHANXI_COUNT ä¸ª"
        
        git add "$FILE_PATH"
        
        # æäº¤ä¿¡æ¯
        COMMIT_MSG="ğŸ“¡ æ›´æ–°å±±è¥¿IPTVç»„æ’­æº - $(date '+%Y-%m-%d %H:%M UTC')"
        COMMIT_MSG="$COMMIT_MSG | å¤§å°: ${FILE_SIZE}å­—èŠ‚"
        
        if [ $FILE_LINES -gt 0 ]; then
          COMMIT_MSG="$COMMIT_MSG | è¡Œæ•°: ${FILE_LINES}è¡Œ"
        fi
        
        if [ $SHANXI_COUNT -gt 0 ]; then
          COMMIT_MSG="$COMMIT_MSG | å±±è¥¿é¢‘é“: ${SHANXI_COUNT}ä¸ª"
        fi
        
        if [ $MULTICAST_COUNT -gt 0 ]; then
          COMMIT_MSG="$COMMIT_MSG | ç»„æ’­: ${MULTICAST_COUNT}ä¸ª"
        fi
        
        git commit -m "$COMMIT_MSG"
        
        echo "æ¨é€åˆ°GitHub..."
        git push
        
        echo "âœ… æäº¤å¹¶æ¨é€å®Œæˆ"
        
    - name: Show detailed final status
      run: |
        echo "=========================================="
        echo "          å±±è¥¿IPTVæºæ›´æ–°æŠ¥å‘Š"
        echo "=========================================="
        
        echo "æ‰§è¡Œå®Œæˆæ—¶é—´: $(date '+%Y-%m-%d %H:%M:%S UTC')"
        echo "å¯¹åº”åŒ—äº¬æ—¶é—´: $(date -d '+8 hours' '+%Y-%m-%d %H:%M:%S')"
        
        echo ""
        if [ -f "tv/shanxi_iptv.txt" ]; then
          echo "âœ… å±±è¥¿IPTVæ–‡ä»¶å­˜åœ¨"
          echo "æ–‡ä»¶ä¿¡æ¯:"
          ls -lh "tv/shanxi_iptv.txt"
          
          echo ""
          echo "ğŸ“Š å†…å®¹åˆ†æ:"
          FILE_SIZE=$(wc -c < "tv/shanxi_iptv.txt")
          FILE_LINES=$(wc -l < "tv/shanxi_iptv.txt")
          echo "æ–‡ä»¶å¤§å°: $FILE_SIZE å­—èŠ‚"
          echo "æ–‡ä»¶è¡Œæ•°: $FILE_LINES è¡Œ"
          
          echo ""
          echo "ğŸ”¢ é¢‘é“ç»Ÿè®¡:"
          echo "å±±è¥¿è”é€š: $(grep -c -i "è”é€š" "tv/shanxi_iptv.txt") ä¸ª"
          echo "å±±è¥¿ç”µä¿¡: $(grep -c -i "ç”µä¿¡" "tv/shanxi_iptv.txt") ä¸ª"
          echo "å±±è¥¿ç§»åŠ¨: $(grep -c -i "ç§»åŠ¨" "tv/shanxi_iptv.txt") ä¸ª"
          echo "ç»„æ’­åœ°å€: $(grep -c -E "rtp://|udp://" "tv/shanxi_iptv.txt") ä¸ª"
          echo "æ€»å±±è¥¿ç›¸å…³: $(grep -c -i "å±±è¥¿" "tv/shanxi_iptv.txt") ä¸ª"
          
          echo ""
          echo "ğŸ“º å†…å®¹é¢„è§ˆ (å‰15è¡Œ):"
          echo "----------------------------------------"
          head -15 "tv/shanxi_iptv.txt"
          echo "----------------------------------------"
          
          echo ""
          echo "ğŸ“¡ ç»„æ’­åœ°å€ç¤ºä¾‹:"
          grep -E "rtp://|udp://" "tv/shanxi_iptv.txt" | head -5 || echo "æœªæ‰¾åˆ°ç»„æ’­åœ°å€"
          
        else
          echo "âŒ å±±è¥¿IPTVæ–‡ä»¶ä¸å­˜åœ¨"
        fi
        
        echo ""
        echo "ğŸ” è¿‡æ»¤è§„åˆ™è¯´æ˜:"
        echo "1. ä¼˜å…ˆæŠ“å– 'å±±è¥¿è”é€š'ã€'å±±è¥¿ç”µä¿¡' ç›¸å…³é¢‘é“"
        echo "2. æŠ“å–æ‰€æœ‰ç»„æ’­åœ°å€ (rtp://, udp://)"
        echo "3. æŠ“å–æ‰€æœ‰åŒ…å« 'å±±è¥¿'ã€'shanxi' å…³é”®è¯çš„é¢‘é“"
        echo "4. è‡ªåŠ¨å»é‡å’Œæ¸…ç†ç©ºè¡Œ"
        
        echo ""
        echo "â° ä¸‹æ¬¡è‡ªåŠ¨æ‰§è¡Œ: æ¯å¤© UTC 01:10 å’Œ 09:10 (åŒ—äº¬æ—¶é—´ 09:10 å’Œ 17:10)"
